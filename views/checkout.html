<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BrandPay Sample</title>
    <script src="https://js.tosspayments.com/v1/brandpay"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
      // 샘플로 제시되는 key는 테스트 용도로만 사용할 수 있음
      var clientKey = 'test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq'
      // customerKey는 가맹점에서 생성하는 것으로 고객별로 고유해야 함. 
      var customerKey = '{UNIQUE_CUSTOMER_KEY}'
      // orderId는 가맹점에서 생성하는 것으로 주문별로 고유해야 함. 
      var orderId = '{UNIQUE_ORDER_ID}'

      // 초기화
      var brandpay = BrandPay(clientKey, customerKey, {
        redirectUrl: 'http://localhost:3000/callback-auth'
      })
     
      function requestPayment() {
        if (!validateParams()) return 

        brandpay.requestPayment({
          amount: 5000, // 결제 금액
          orderId: orderId, // 주문에 대한 ID 값. 주문별로 고유해야 함
          orderName: '토스 티셔츠 외 2건', // 주문명
          customerEmail: 'customer@email.com', // 고객의 이메일 주소 (optional)
        })
          .then((res) => {
            // 결제 승인 요청
            return axios.post('http://localhost:3000/confirm-payment', res)
          })
          .then(() => {
            // 결제 성공 페이지로 redirect
            window.location.href = 'http://localhost:3000/payment-success'
          })
          .catch((err) => {
            if (err.code == 'USER_CANCEL') {
              console.log('사용자 취소')
            } else {
              console.log('기타 에러 상황', err.code, err.message)

              // 결제 실패 페이지로 redirect
              window.location.href = 'http://localhost:3000/payment-fail'
            }
          })
      }

      function validateParams() {
        if (customerKey === '{UNIQUE_CUSTOMER_KEY}') {
          alert('views/checkout.html 파일의 customerKey 값을 설정해주세요.')
          return false
        } else if (orderId === '{UNIQUE_ORDER_ID}') {
          alert('views/checkout.html 파일의 orderId 값을 설정해주세요.')
          return false
        }

        return true
      }
  </script>

  </head>
  <body>
    <button onclick="requestPayment()">결제하기</button>
  </body>
</html>

